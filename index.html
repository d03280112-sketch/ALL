<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ALL ä¸»æ§å°</title>
  <style>
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Microsoft JhengHei",sans-serif;
      background:#0b0b0b;
      color:#fff;
    }
    .wrap{max-width:1100px;margin:0 auto;padding:26px;}

    .panel{
      background:#141414;border:1px solid #2a2a2a;border-radius:18px;
      padding:18px;margin:14px 0;
    }

    /* ä¸Šæ–¹é¡¯ç¤ºå€ */
    .topPick{
      display:flex;gap:16px;align-items:center;justify-content:space-between;flex-wrap:wrap;
    }
    .pickBox{
      flex:1;
      min-width:280px;
      border:1px solid #2a2a2a;
      border-radius:18px;
      padding:18px;
      background:#0f0f0f;
    }
    .pickLabel{opacity:.75}

    /* âœ… ä¸Šæ–¹ä¸»é¡Œå­—ï¼šæ›´å¤§ã€ç½®ä¸­ã€èˆå°æ„Ÿ */
    .pickName{
      margin-top:10px;
      font-size:88px;
      font-weight:1000;
      letter-spacing:2px;
      color:#00e5ff;
      text-shadow:
        0 0 18px rgba(0,229,255,.55),
        0 0 36px rgba(0,229,255,.35),
        0 0 60px rgba(0,229,255,.18);
      line-height:1.05;
      word-break:break-word;
      text-align:center;
      transition: transform .08s linear, filter .08s linear;
    }
    .pickSub{
      margin-top:10px;
      opacity:.85;
      font-weight:900;
      text-align:center;
    }

    .btnRow{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    button{
      border:0;border-radius:16px;padding:14px 18px;font-weight:1000;cursor:pointer;
      font-size:18px;
    }
    #btnPick{background:#00e5ff;color:#001015}
    #btnStart{background:#ffd400;color:#1a1200}
    #btnReset{background:#222;color:#fff;border:1px solid #333}
    button:disabled{opacity:.45;cursor:not-allowed}

    /* 14 ä¸»é¡Œæ ¼ */
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:14px;
      margin-top:12px;
    }
    .topic{
      border-radius:18px;
      padding:20px 16px;
      border:1px solid #2a2a2a;
      background:#101010;
      opacity:1;
      transition:opacity .12s linear, transform .12s linear, box-shadow .12s linear, border-color .12s linear;
      user-select:none;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:74px;
      text-align:center;
      position:relative;
    }
    .topic .name{
      font-size:30px;
      font-weight:1000;
      letter-spacing:.5px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:100%;
    }
    .topic.used{
      opacity:.18;
      filter:saturate(.6);
    }
    .topic.active{
      transform:scale(1.04);
      border-color:#00e5ff;
      box-shadow:0 0 18px rgba(0,229,255,.35);
    }
    .topic.locked{
      opacity:1;
      border-color:#ffd400;
      box-shadow:0 0 24px rgba(255,212,0,.55);
      transform:scale(1.03);
    }
    .badge{
      position:absolute;top:10px;right:10px;
      font-size:12px;font-weight:1000;
      padding:6px 10px;border-radius:999px;
      background:#222;border:1px solid #333;
      opacity:.9;
    }
    .topic.used .badge{background:#111;border-color:#222;opacity:.8}
    .topic.locked .badge{background:#1a1200;border-color:#ffd400}

    /* âœ… å…¨ç•«é¢ç½®ä¸­æŠ½é¸é®ç½©ï¼šå¹³å¸¸ä¸é¡¯ç¤º */
    .overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.78);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:99999;
      padding:24px;
    }
    .overlay.show{display:flex;}

    .overlayText{
      font-size:min(14vw, 140px);
      font-weight:1000;
      letter-spacing:2px;
      text-align:center;
      color:#00e5ff;
      text-shadow:
        0 0 18px rgba(0,229,255,.65),
        0 0 40px rgba(0,229,255,.4),
        0 0 80px rgba(0,229,255,.18);
      line-height:1.05;
      transform:scale(1);
    }

    /* ğŸ¤ å‘¼å¸æ„Ÿï¼šæŠ½é¸ä¸­ */
    .breathing{
      animation: breathe .55s ease-in-out infinite;
    }
    @keyframes breathe{
      0%{ transform:scale(1); filter:brightness(1); }
      50%{ transform:scale(1.035); filter:brightness(1.12); }
      100%{ transform:scale(1); filter:brightness(1); }
    }

    /* ğŸ”” åœä¸‹ç¬é–“ï¼šé–ƒä¸€ä¸‹/ç™¼å…‰ */
    .flash{
      animation: flashGlow .65s ease-out 1;
    }
    @keyframes flashGlow{
      0%{ transform:scale(1); filter:brightness(1); }
      25%{ transform:scale(1.07); filter:brightness(1.55); }
      55%{ transform:scale(1.02); filter:brightness(1.15); }
      100%{ transform:scale(1); filter:brightness(1); }
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="panel topPick">
    <div class="pickBox">
      <div class="pickLabel">ç›®å‰æŠ½åˆ°çš„é¸é …</div>
      <div class="pickName" id="pickedName">ï¼ˆå°šæœªæŠ½ï¼‰</div>
      <div class="pickSub" id="pickedHint">è«‹å…ˆæŒ‰ã€ŒæŠ½é¸ã€</div>
    </div>

    <div class="btnRow">
      <button id="btnPick">æŠ½é¸</button>
      <button id="btnStart" disabled>Startï¼ˆé€²å…¥é¡Œç›®ï¼‰</button>
      <button id="btnReset">é‡ç½®ï¼ˆå…¨éƒ¨å›ä¾†ï¼‰</button>
    </div>
  </div>

  <div class="panel">
    <div class="grid" id="grid"></div>
  </div>
</div>

<!-- âœ… å…¨ç•«é¢ç½®ä¸­æŠ½é¸é®ç½© -->
<div class="overlay" id="overlay">
  <div class="overlayText" id="overlayText">æŠ½é¸ä¸­</div>
</div>

<script>
  const GROUPS = [
    { name: "æ–‡å…·",   url: "https://d03280112-sketch.github.io/pen/" },
    { name: "æ°´æœ",   url: "https://d03280112-sketch.github.io/-fruit/" },
    { name: "ä¸‰åœ‹",   url: "https://d03280112-sketch.github.io/Three-Kingdoms/" },
    { name: "å°ç£",   url: "https://d03280112-sketch.github.io/taiwan/" },
    { name: "å“ç‰Œ",   url: "https://d03280112-sketch.github.io/brand/" },
    { name: "æˆèª",   url: "https://d03280112-sketch.github.io/idiom/" },
    { name: "æ–™ç†A",  url: "https://d03280112-sketch.github.io/cookA/" },
    { name: "æ–™ç†B",  url: "https://d03280112-sketch.github.io/cookB/" },
    { name: "é‹å‹•",   url: "https://d03280112-sketch.github.io/sports/" },
    { name: "é›¶é£Ÿ",   url: "https://d03280112-sketch.github.io/snack/" },
    { name: "é›»å™¨",   url: "https://d03280112-sketch.github.io/3C/" },
    { name: "è”¬èœ",   url: "https://d03280112-sketch.github.io/vegetable/" },
    { name: "è¾¦å…¬å®¤", url: "https://d03280112-sketch.github.io/offiice/" },
    { name: "è·æ¥­",   url: "https://d03280112-sketch.github.io/Profession/" }
  ];

  const KEY_USED = "all_used_groups_v5";
  const KEY_LAST = "all_last_pick_v5";

  const elGrid = document.getElementById("grid");
  const btnPick = document.getElementById("btnPick");
  const btnStart = document.getElementById("btnStart");
  const btnReset = document.getElementById("btnReset");
  const elPickedName = document.getElementById("pickedName");
  const elPickedHint = document.getElementById("pickedHint");

  const overlay = document.getElementById("overlay");
  const overlayText = document.getElementById("overlayText");

  let spinning = false;
  let currentActive = null;
  let pickedIdx = null; // æœ¬æ¬¡æŠ½åˆ°ï¼ˆä½†æœªè·³è½‰ï¼‰

  function loadUsed(){
    try {
      const v = JSON.parse(localStorage.getItem(KEY_USED) || "[]");
      return Array.isArray(v) ? v : [];
    } catch { return []; }
  }
  function saveUsed(arr){ localStorage.setItem(KEY_USED, JSON.stringify(arr)); }
  function saveLast(idx){ localStorage.setItem(KEY_LAST, String(idx)); }
  function loadLast(){
    const v = localStorage.getItem(KEY_LAST);
    const n = Number(v);
    return Number.isFinite(n) ? n : null;
  }

  function candidates(){
    const used = new Set(loadUsed());
    const out = [];
    for (let i=0;i<GROUPS.length;i++){
      if (!used.has(i)) out.push(i);
    }
    return out;
  }

  function clearActive(){
    if (currentActive === null) return;
    const el = elGrid.querySelector(`.topic[data-idx="${currentActive}"]`);
    if (el) el.classList.remove("active");
    currentActive = null;
  }

  // âœ… åŒæ­¥ä¸Šæ–¹ + å…¨ç•«é¢æ–‡å­—
  function setActive(idx){
    if (currentActive === idx) return;
    clearActive();

    const el = elGrid.querySelector(`.topic[data-idx="${idx}"]`);
    if (el) el.classList.add("active");
    currentActive = idx;

    elPickedName.textContent = GROUPS[idx].name;
    overlayText.textContent = GROUPS[idx].name;
  }

  function render(){
    const used = new Set(loadUsed());
    elGrid.innerHTML = "";

    GROUPS.forEach((g,i)=>{
      const div = document.createElement("div");
      div.className = "topic" + (used.has(i) ? " used" : "");
      div.dataset.idx = String(i);

      const badge = document.createElement("div");
      badge.className = "badge";
      badge.textContent = used.has(i) ? "å·²é¸" : "å¯é¸";

      const name = document.createElement("div");
      name.className = "name";
      name.textContent = g.name;

      div.appendChild(badge);
      div.appendChild(name);

      elGrid.appendChild(div);
    });

    // æŠ½åˆ°çµæœï¼šæ†äº®ï¼ˆä½†ä»ç®—å·²é¸ï¼‰
    if (pickedIdx !== null){
      const el = elGrid.querySelector(`.topic[data-idx="${pickedIdx}"]`);
      if (el){
        el.classList.remove("active");
        el.classList.add("locked");
        el.classList.remove("used");
        const b = el.querySelector(".badge");
        if (b) b.textContent = "æœ¬æ¬¡";
      }
    }

    btnPick.disabled = spinning || candidates().length === 0;
    btnStart.disabled = (pickedIdx === null);
  }

  function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

  function showOverlay(){
    overlay.classList.add("show");
    overlayText.classList.add("breathing");
    elPickedName.classList.add("breathing");
    elPickedHint.textContent = ""; // ä¸é¡¯ç¤ºã€ŒæŠ½é¸ä¸­ã€
  }
  function hideOverlay(){
    overlay.classList.remove("show");
    overlayText.classList.remove("breathing");
    elPickedName.classList.remove("breathing");
  }
  function flashFinal(){
    overlayText.classList.remove("flash");
    elPickedName.classList.remove("flash");
    void overlayText.offsetWidth; // reflow
    overlayText.classList.add("flash");
    elPickedName.classList.add("flash");
  }

  async function spinPick(){
    if (spinning) return;
    const pool = candidates();
    if (pool.length === 0) {
      elPickedName.textContent = "";
      elPickedHint.textContent = "";
      btnStart.disabled = true;
      return;
    }

    spinning = true;
    btnPick.disabled = true;
    btnStart.disabled = true;

    // æŠ½ä¹‹å‰å…ˆæ¸…æ‰ä¸Šæ¬¡ locked
    pickedIdx = null;
    render();

    // âœ… é–‹å•Ÿå…¨ç•«é¢ç½®ä¸­æŠ½é¸
    showOverlay();

    // 3.5 ç§’è·‘é¦¬ç‡ˆ
    const TOTAL_MS = 3500;
    const START_DELAY = 60;
    const END_DELAY = 320;
    const approxSteps = Math.max(10, Math.floor(TOTAL_MS / ((START_DELAY + END_DELAY) / 2)));

    const delays = [];
    for (let i=0;i<approxSteps;i++){
      const t = i / (approxSteps - 1);
      const eased = 1 - Math.pow(1 - t, 2.2);
      delays.push(Math.round(START_DELAY + (END_DELAY - START_DELAY) * eased));
    }

    for (let i=0;i<delays.length;i++){
      const idx = pool[Math.floor(Math.random() * pool.length)];
      setActive(idx);
      await sleep(delays[i]);
    }

    // æœ€çµ‚çµæœ
    const finalIdx = pool[Math.floor(Math.random() * pool.length)];
    setActive(finalIdx);
    await sleep(220);

    // è¨˜ç‚ºå·²é¸ï¼ˆä¸‹æ–¹è®Šæš—ï¼‰
    const usedArr = loadUsed();
    usedArr.push(finalIdx);
    saveUsed(usedArr);
    saveLast(finalIdx);

    pickedIdx = finalIdx;

    // ğŸ”” åœä¸‹ç¬é–“é–ƒä¸€ä¸‹
    flashFinal();

    // åœä½ 0.55 ç§’è®“å¤§å®¶çœ‹æ¸…æ¥š
    await sleep(550);

    // é—œé–‰å…¨ç•«é¢é®ç½©ï¼Œä½†ä¸Šæ–¹ä¿ç•™çµæœ
    hideOverlay();

    spinning = false;
    clearActive();
    render();

    // Start æ‰è·³è½‰
    elPickedHint.textContent = "";
  }

  btnPick.addEventListener("click", spinPick);

  btnStart.addEventListener("click", ()=>{
    if (pickedIdx === null) return;
    window.location.href = GROUPS[pickedIdx].url;
  });

  btnReset.addEventListener("click", ()=>{
    localStorage.removeItem(KEY_USED);
    localStorage.removeItem(KEY_LAST);
    pickedIdx = null;
    clearActive();
    elPickedName.textContent = "ï¼ˆå°šæœªæŠ½ï¼‰";
    overlayText.textContent = "";
    elPickedHint.textContent = "";
    hideOverlay();
    render();
  });

  // é‡æ–°æ•´ç†å¾Œé¡¯ç¤ºä¸Šæ¬¡çµæœï¼ˆä¸è‡ªå‹•è·³ï¼‰
  (function initLast(){
    const last = loadLast();
    if (last !== null && last >= 0 && last < GROUPS.length){
      elPickedName.textContent = GROUPS[last].name;
      overlayText.textContent = GROUPS[last].name;
      elPickedHint.textContent = "";
    } else {
      overlayText.textContent = "";
      elPickedHint.textContent = "";
    }
  })();

  render();
</script>
</body>
</html>
