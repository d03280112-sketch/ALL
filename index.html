<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ä¸»æ§å°ï½œ14 çµ„æŠ½é¸</title>
  <style>
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Microsoft JhengHei",sans-serif;
      background:#0b0b0b;
      color:#fff;
    }
    .wrap{max-width:1100px;margin:0 auto;padding:26px;}
    h1{margin:0 0 10px;font-size:30px;}
    .hint{opacity:.8;line-height:1.7}
    .panel{
      background:#141414;border:1px solid #2a2a2a;border-radius:18px;
      padding:18px;margin:14px 0;
    }
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;}
    button{
      border:0;border-radius:16px;padding:12px 18px;font-weight:900;cursor:pointer;
      background:#00e5ff;color:#001015;font-size:18px;
    }
    button.secondary{background:#ffd400;color:#1a1200}
    button.ghost{background:#222;color:#fff;border:1px solid #333}
    button:disabled{opacity:.45;cursor:not-allowed}

    .big{
      font-size:58px;font-weight:1000;letter-spacing:1px;color:#ffd400;
      text-shadow:0 0 12px rgba(255,212,0,.55);
      line-height:1;
    }

    /* 14 ä¸»é¡Œæ–‡å­—å€ */
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:14px;
      margin-top:12px;
    }
    .topic{
      position:relative;
      border-radius:18px;
      padding:18px 16px;
      border:1px solid #2a2a2a;
      background:#0f0f0f;
      opacity:.30;                /* åŸæœ¬æš—çš„ */
      transform:scale(1);
      transition:opacity .12s linear, transform .12s linear, box-shadow .12s linear, border-color .12s linear;
      user-select:none;
    }
    .topic .name{
      font-size:28px;
      font-weight:1000;
      letter-spacing:.5px;
      margin-bottom:8px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .topic .url{
      font-size:12px;
      opacity:.8;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .topic.active{
      opacity:1;
      transform:scale(1.03);
      border-color:#00e5ff;
      box-shadow:0 0 18px rgba(0,229,255,.35);
    }

    .topic.locked{
      opacity:1;
      border-color:#ffd400;
      box-shadow:0 0 26px rgba(255,212,0,.55);
    }

    .badge{
      position:absolute;top:10px;right:10px;
      font-size:12px;font-weight:900;
      padding:6px 10px;border-radius:999px;
      background:#222;border:1px solid #333;
      opacity:.9;
    }
    .topic.locked .badge{background:#1a1200;border-color:#ffd400}
    .topic.used{
      opacity:.15;
      filter:saturate(.7);
    }
    .topic.used.locked{opacity:1;filter:none;}
    .footerRow{
      display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:flex-start;
      margin-top:12px;
    }
    a.link{
      color:#00e5ff;text-decoration:none;font-weight:900
    }
    a.link:hover{text-decoration:underline}
  </style>
</head>
<body>
<div class="wrap">
  <h1>ğŸ² ä¸»æ§å°ï¼š14 ä¸»é¡ŒæŠ½é¸ï¼ˆè·‘é¦¬ç‡ˆï¼‰</h1>
  <div class="hint">
    æŒ‰ã€Œé–‹å§‹æŠ½é¸ã€å¾Œï¼Œ14 å€‹ä¸»é¡Œæœƒéš¨æ©Ÿäº®èµ·åˆæš—ä¸‹ä¾†ï¼Œé€Ÿåº¦æœƒæ…¢æ…¢æ”¾æ…¢ï¼Œæœ€å¾Œåœåœ¨æŠ½ä¸­çš„ä¸»é¡Œä¸¦ä¿æŒæ†äº®ã€‚<br/>
    æŠ½åˆ°å¾Œæœƒè‡ªå‹•è·³åˆ°è©²ä¸»é¡Œé é¢ï¼ˆGitHub Pagesï¼‰ã€‚æŠ½éçš„ä¸»é¡Œä¸æœƒå†è¢«æŠ½åˆ°ï¼Œç›´åˆ°æŠ½å®Œå¯æŒ‰é‡ç½®ã€‚
  </div>

  <div class="panel">
    <div class="row">
      <div>
        <div style="opacity:.7">å‰©é¤˜ä¸»é¡Œæ•¸</div>
        <div class="big" id="remain">14</div>
      </div>
      <div style="min-width:360px">
        <div style="opacity:.7">æœ¬æ¬¡æŠ½åˆ°</div>
        <div style="font-size:20px;font-weight:1000" id="pickedName">ï¼ˆå°šæœªæŠ½ï¼‰</div>
        <div style="margin-top:6px">
          <a class="link" id="pickedLink" href="#" target="_self" style="display:none">é–‹å•Ÿæ­¤ä¸»é¡Œ</a>
        </div>
      </div>
    </div>

    <div class="footerRow">
      <button id="btnPick">é–‹å§‹æŠ½é¸</button>
      <button class="secondary" id="btnReset">é‡ç½®ï¼ˆå…¨éƒ¨å›ä¾†ï¼‰</button>
      <button class="ghost" id="btnOpenLast">é–‹å•Ÿä¸Šä¸€æ¬¡æŠ½åˆ°çš„ä¸»é¡Œ</button>
    </div>
  </div>

  <div class="panel">
    <div style="font-weight:1000;margin-bottom:8px">14 ä¸»é¡Œ</div>
    <div class="grid" id="grid"></div>
  </div>
</div>

<script>
  // âœ… ä½ çš„ 14 çµ„ç¶²å€ï¼ˆå·²å¡«å¥½ï¼‰
  const GROUPS = [
    { name: "æ–‡å…·",   url: "https://d03280112-sketch.github.io/pen/" },
    { name: "æ°´æœ",   url: "https://d03280112-sketch.github.io/-fruit/" },
    { name: "ä¸‰åœ‹",   url: "https://d03280112-sketch.github.io/Three-Kingdoms/" },
    { name: "å°ç£",   url: "https://d03280112-sketch.github.io/taiwan/" },
    { name: "å“ç‰Œ",   url: "https://d03280112-sketch.github.io/brand/" },
    { name: "æˆèª",   url: "https://d03280112-sketch.github.io/idiom/" },
    { name: "æ–™ç†A",  url: "https://d03280112-sketch.github.io/cookA/" },
    { name: "æ–™ç†B",  url: "https://d03280112-sketch.github.io/cookB/" },
    { name: "é‹å‹•",   url: "https://d03280112-sketch.github.io/sports/" },
    { name: "é›¶é£Ÿ",   url: "https://d03280112-sketch.github.io/snack/" },
    { name: "é›»å™¨",   url: "https://d03280112-sketch.github.io/3C/" },
    { name: "è”¬èœ",   url: "https://d03280112-sketch.github.io/vegetable/" },
    { name: "è¾¦å…¬å®¤", url: "https://d03280112-sketch.github.io/offiice/" },
    { name: "è·æ¥­",   url: "https://d03280112-sketch.github.io/Profession/" }
  ];

  const KEY_USED = "quiz_used_groups_v2";
  const KEY_LAST = "quiz_last_group_v2";

  const elRemain = document.getElementById("remain");
  const elPickedName = document.getElementById("pickedName");
  const elPickedLink = document.getElementById("pickedLink");
  const elGrid = document.getElementById("grid");
  const btnPick = document.getElementById("btnPick");
  const btnReset = document.getElementById("btnReset");
  const btnOpenLast = document.getElementById("btnOpenLast");

  let spinning = false;
  let currentActive = null;

  function loadUsed(){
    try {
      const v = JSON.parse(localStorage.getItem(KEY_USED) || "[]");
      return Array.isArray(v) ? v : [];
    } catch { return []; }
  }
  function saveUsed(arr){ localStorage.setItem(KEY_USED, JSON.stringify(arr)); }
  function saveLast(idx){ localStorage.setItem(KEY_LAST, String(idx)); }
  function loadLast(){
    const v = localStorage.getItem(KEY_LAST);
    const n = Number(v);
    return Number.isFinite(n) ? n : null;
  }

  function renderGrid(){
    const used = new Set(loadUsed());
    const remain = GROUPS.length - used.size;
    elRemain.textContent = String(remain);
    btnPick.disabled = (remain <= 0) || spinning;

    elGrid.innerHTML = "";
    GROUPS.forEach((g, i) => {
      const div = document.createElement("div");
      div.className = "topic" + (used.has(i) ? " used" : "");
      div.dataset.idx = String(i);

      const badge = document.createElement("div");
      badge.className = "badge";
      badge.textContent = used.has(i) ? "å·²æŠ½" : "æœªæŠ½";

      const name = document.createElement("div");
      name.className = "name";
      name.textContent = g.name;

      const url = document.createElement("div");
      url.className = "url";
      url.textContent = g.url;

      div.appendChild(badge);
      div.appendChild(name);
      div.appendChild(url);

      // å…è¨±é»æ“Šç›´æ¥é–‹å•Ÿï¼ˆæ–¹ä¾¿æ¸¬è©¦ï¼‰
      div.addEventListener("click", () => {
        if (spinning) return;
        window.location.href = g.url;
      });

      elGrid.appendChild(div);
    });
  }

  function clearActive(){
    if (currentActive === null) return;
    const el = elGrid.querySelector(`.topic[data-idx="${currentActive}"]`);
    if (el) el.classList.remove("active");
    currentActive = null;
  }

  function setActive(idx){
    if (currentActive === idx) return;
    clearActive();
    const el = elGrid.querySelector(`.topic[data-idx="${idx}"]`);
    if (el) el.classList.add("active");
    currentActive = idx;
  }

  function lockPicked(idx){
    const el = elGrid.querySelector(`.topic[data-idx="${idx}"]`);
    if (el) {
      el.classList.remove("active");
      el.classList.add("locked");
    }
  }

  function pickCandidates(){
    const used = new Set(loadUsed());
    const candidates = [];
    for (let i=0;i<GROUPS.length;i++){
      if (!used.has(i)) candidates.push(i);
    }
    return candidates;
  }

  function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }

  async function spinAndPick(){
    if (spinning) return;
    const candidates = pickCandidates();
    if (candidates.length === 0) return;

    spinning = true;
    btnPick.disabled = true;

    // è·‘é¦¬ç‡ˆåƒæ•¸ï¼šä¸€é–‹å§‹å¿«ã€é€æ­¥è®Šæ…¢
    let delay = 60;          // åˆå§‹é€Ÿåº¦ï¼ˆè¶Šå°è¶Šå¿«ï¼‰
    const delayGrow = 1.12;  // æ¯æ¬¡å»¶é²ä¹˜ä¸Šå€ç‡ â†’ é€æ­¥æ”¾æ…¢
    const maxDelay = 420;    // æœ€æ…¢åœä¸‹ä¾†å‰çš„å»¶é²
    const minSteps = 28;     // æœ€å°‘è·³å‹•æ¬¡æ•¸ï¼ˆä¿è­‰æœ‰è·‘ä¸€æ®µï¼‰
    const maxSteps = 55;     // æœ€å¤šè·³å‹•æ¬¡æ•¸ï¼ˆé¿å…å¤ªä¹…ï¼‰
    const steps = Math.floor(Math.random() * (maxSteps - minSteps + 1)) + minSteps;

    // è®“å®ƒçœŸçš„ã€Œéš¨æ©Ÿäº®èµ·ã€ï¼šæ¯æ¬¡å¾å€™é¸è£¡éš¨æ©ŸæŒ‘ä¸€å€‹é»äº®
    for (let s=0; s<steps; s++){
      const idx = candidates[Math.floor(Math.random() * candidates.length)];
      setActive(idx);

      await sleep(delay);
      delay = Math.min(maxDelay, Math.floor(delay * delayGrow));
    }

    // æœ€å¾Œæ±ºé¸ï¼šå†å¾å€™é¸è£¡é¸ä¸€å€‹ç•¶çµæœï¼ˆå¯é¿å…æœ€å¾Œä¸€æ¬¡å‰›å¥½æ˜¯èˆŠå€¼ï¼‰
    const finalIdx = candidates[Math.floor(Math.random() * candidates.length)];

    // åšä¸€å€‹å°å°ã€Œå®šæ ¼ã€æ•ˆæœ
    setActive(finalIdx);
    await sleep(Math.min(520, delay + 120));

    // è¨˜éŒ„å·²æŠ½
    const usedArr = loadUsed();
    usedArr.push(finalIdx);
    saveUsed(usedArr);
    saveLast(finalIdx);

    // UI é¡¯ç¤º
    const g = GROUPS[finalIdx];
    elPickedName.textContent = `ã€${g.name}ã€‘`;
    elPickedLink.href = g.url;
    elPickedLink.style.display = "inline-block";

    // æ†äº®ï¼ˆé–å®šï¼‰
    lockPicked(finalIdx);

    // æ›´æ–°å‰©é¤˜/ç‹€æ…‹
    renderGrid();

    spinning = false;

    // ç¨ç­‰ä¸€ä¸‹è®“ä¸»æŒäººçœ‹åˆ°çµæœï¼Œå†è·³è½‰
    setTimeout(() => {
      window.location.href = g.url;
    }, 700);
  }

  btnPick.addEventListener("click", spinAndPick);

  btnReset.addEventListener("click", () => {
    localStorage.removeItem(KEY_USED);
    localStorage.removeItem(KEY_LAST);
    elPickedName.textContent = "ï¼ˆå°šæœªæŠ½ï¼‰";
    elPickedLink.style.display = "none";
    clearActive();
    renderGrid();
  });

  btnOpenLast.addEventListener("click", () => {
    const idx = loadLast();
    if (idx === null || idx < 0 || idx >= GROUPS.length) return;
    window.location.href = GROUPS[idx].url;
  });

  renderGrid();
</script>
</body>
</html>
