<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ä¸»æ§å°ï½œ14 ä¸»é¡ŒæŠ½é¸ï¼ˆæŒ‰ Start æ‰è·³è½‰ï¼‰</title>
  <style>
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Microsoft JhengHei",sans-serif;
      background:#0b0b0b;
      color:#fff;
    }
    .wrap{max-width:1100px;margin:0 auto;padding:26px;}
    h1{margin:0 0 10px;font-size:30px;}
    .hint{opacity:.8;line-height:1.7}

    .panel{
      background:#141414;border:1px solid #2a2a2a;border-radius:18px;
      padding:18px;margin:14px 0;
    }

    .topPick{
      display:flex;gap:16px;align-items:center;justify-content:space-between;flex-wrap:wrap;
    }
    .pickBox{
      flex:1;
      min-width:280px;
      border:1px solid #2a2a2a;
      border-radius:18px;
      padding:18px;
      background:#0f0f0f;
    }
    .pickLabel{opacity:.75}
    .pickName{
      margin-top:8px;
      font-size:56px;
      font-weight:1000;
      letter-spacing:1px;
      color:#00e5ff;
      text-shadow:0 0 18px rgba(0,229,255,.35);
      line-height:1.1;
      word-break:break-word;
    }
    .pickSub{
      margin-top:10px;
      opacity:.85;
      font-weight:800;
    }

    .btnRow{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    button{
      border:0;border-radius:16px;padding:14px 18px;font-weight:1000;cursor:pointer;
      font-size:18px;
    }
    #btnPick{background:#00e5ff;color:#001015}
    #btnStart{background:#ffd400;color:#1a1200}
    #btnReset{background:#222;color:#fff;border:1px solid #333}
    button:disabled{opacity:.45;cursor:not-allowed}

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:14px;
      margin-top:12px;
    }
    .topic{
      border-radius:18px;
      padding:20px 16px;
      border:1px solid #2a2a2a;
      background:#101010;
      opacity:1;                /* ä¸€é–‹å§‹éƒ½äº® */
      transition:opacity .12s linear, transform .12s linear, box-shadow .12s linear, border-color .12s linear;
      user-select:none;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:74px;
      text-align:center;
      position:relative;
    }
    .topic .name{
      font-size:30px;
      font-weight:1000;
      letter-spacing:.5px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:100%;
    }

    /* æŠ½é¸éçš„ï¼šè®Šæš— */
    .topic.used{
      opacity:.18;
      filter:saturate(.6);
    }

    /* æŠ½é¸å‹•ç•«äº®èµ· */
    .topic.active{
      transform:scale(1.04);
      border-color:#00e5ff;
      box-shadow:0 0 18px rgba(0,229,255,.35);
    }

    /* æŠ½åˆ°çµæœï¼šæ†äº® */
    .topic.locked{
      opacity:1;
      border-color:#ffd400;
      box-shadow:0 0 24px rgba(255,212,0,.55);
      transform:scale(1.03);
    }

    .badge{
      position:absolute;top:10px;right:10px;
      font-size:12px;font-weight:1000;
      padding:6px 10px;border-radius:999px;
      background:#222;border:1px solid #333;
      opacity:.9;
    }
    .topic.used .badge{background:#111;border-color:#222;opacity:.8}
    .topic.locked .badge{background:#1a1200;border-color:#ffd400}
  </style>
</head>
<body>
<div class="wrap">
  <h1>ğŸ² ä¸»æ§å°ï¼š14 ä¸»é¡ŒæŠ½é¸</h1>
  <div class="hint">
    æŒ‰ã€ŒæŠ½é¸ã€æœƒè½‰ 3.5 ç§’åœä½ã€‚<br/>
    æŠ½åˆ°å¾Œæœƒå…ˆé¡¯ç¤ºåœ¨ä¸Šæ–¹ä¸¦æŠŠè©²ä¸»é¡Œè®Šæš—ï¼ˆå·²ç”¨ï¼‰ã€‚è¦é€²å…¥é¡Œç›®è«‹æŒ‰ã€ŒStartã€æ‰è·³è½‰ã€‚
  </div>

  <div class="panel topPick">
    <div class="pickBox">
      <div class="pickLabel">ç›®å‰æŠ½åˆ°çš„é¸é …</div>
      <div class="pickName" id="pickedName">ï¼ˆå°šæœªæŠ½ï¼‰</div>
      <div class="pickSub" id="pickedHint">è«‹å…ˆæŒ‰ã€ŒæŠ½é¸ã€</div>
    </div>

    <div class="btnRow">
      <button id="btnPick">æŠ½é¸</button>
      <button id="btnStart" disabled>Startï¼ˆé€²å…¥é¡Œç›®ï¼‰</button>
      <button id="btnReset">é‡ç½®ï¼ˆå…¨éƒ¨å›ä¾†ï¼‰</button>
    </div>
  </div>

  <div class="panel">
    <div style="font-weight:1000;margin-bottom:8px">14 ä¸»é¡Œ</div>
    <div class="grid" id="grid"></div>
  </div>
</div>

<script>
  // 14 çµ„ï¼ˆåªé¡¯ç¤º nameï¼Œä¸é¡¯ç¤º urlï¼‰
  const GROUPS = [
    { name: "æ–‡å…·",   url: "https://d03280112-sketch.github.io/pen/" },
    { name: "æ°´æœ",   url: "https://d03280112-sketch.github.io/-fruit/" },
    { name: "ä¸‰åœ‹",   url: "https://d03280112-sketch.github.io/Three-Kingdoms/" },
    { name: "å°ç£",   url: "https://d03280112-sketch.github.io/taiwan/" },
    { name: "å“ç‰Œ",   url: "https://d03280112-sketch.github.io/brand/" },
    { name: "æˆèª",   url: "https://d03280112-sketch.github.io/idiom/" },
    { name: "æ–™ç†A",  url: "https://d03280112-sketch.github.io/cookA/" },
    { name: "æ–™ç†B",  url: "https://d03280112-sketch.github.io/cookB/" },
    { name: "é‹å‹•",   url: "https://d03280112-sketch.github.io/sports/" },
    { name: "é›¶é£Ÿ",   url: "https://d03280112-sketch.github.io/snack/" },
    { name: "é›»å™¨",   url: "https://d03280112-sketch.github.io/3C/" },
    { name: "è”¬èœ",   url: "https://d03280112-sketch.github.io/vegetable/" },
    { name: "è¾¦å…¬å®¤", url: "https://d03280112-sketch.github.io/offiice/" },
    { name: "è·æ¥­",   url: "https://d03280112-sketch.github.io/Profession/" }
  ];

  const KEY_USED = "all_used_groups_v4";
  const KEY_LAST = "all_last_pick_v4";

  const elGrid = document.getElementById("grid");
  const btnPick = document.getElementById("btnPick");
  const btnStart = document.getElementById("btnStart");
  const btnReset = document.getElementById("btnReset");
  const elPickedName = document.getElementById("pickedName");
  const elPickedHint = document.getElementById("pickedHint");

  let spinning = false;
  let currentActive = null;
  let pickedIdx = null; // æœ¬æ¬¡æŠ½åˆ°ï¼ˆä½†æœªè·³è½‰ï¼‰

  function loadUsed(){
    try {
      const v = JSON.parse(localStorage.getItem(KEY_USED) || "[]");
      return Array.isArray(v) ? v : [];
    } catch { return []; }
  }
  function saveUsed(arr){ localStorage.setItem(KEY_USED, JSON.stringify(arr)); }

  function saveLast(idx){ localStorage.setItem(KEY_LAST, String(idx)); }
  function loadLast(){
    const v = localStorage.getItem(KEY_LAST);
    const n = Number(v);
    return Number.isFinite(n) ? n : null;
  }

  function candidates(){
    const used = new Set(loadUsed());
    const out = [];
    for (let i=0;i<GROUPS.length;i++){
      if (!used.has(i)) out.push(i);
    }
    return out;
  }

  function clearActive(){
    if (currentActive === null) return;
    const el = elGrid.querySelector(`.topic[data-idx="${currentActive}"]`);
    if (el) el.classList.remove("active");
    currentActive = null;
  }
  function setActive(idx){
    if (currentActive === idx) return;
    clearActive();
    const el = elGrid.querySelector(`.topic[data-idx="${idx}"]`);
    if (el) el.classList.add("active");
    currentActive = idx;
  }

  function render(){
    const used = new Set(loadUsed());
    elGrid.innerHTML = "";

    GROUPS.forEach((g,i)=>{
      const div = document.createElement("div");
      div.className = "topic" + (used.has(i) ? " used" : "");
      div.dataset.idx = String(i);

      const badge = document.createElement("div");
      badge.className = "badge";
      badge.textContent = used.has(i) ? "å·²é¸" : "å¯é¸";

      const name = document.createElement("div");
      name.className = "name";
      name.textContent = g.name;

      div.appendChild(badge);
      div.appendChild(name);

      elGrid.appendChild(div);
    });

    // å¦‚æœå‰›æŠ½åˆ°ï¼Œæ¨™è¨˜ locked
    if (pickedIdx !== null){
      const el = elGrid.querySelector(`.topic[data-idx="${pickedIdx}"]`);
      if (el){
        el.classList.remove("active");
        el.classList.add("locked");
        // å·²é¸çš„åŒæ™‚ä¹Ÿè¦æš—æ‰ï¼Œä½† locked è¦äº®ï¼Œæ‰€ä»¥ç”¨ locked è¦†è“‹è¦–è¦º
        el.classList.remove("used");
        const b = el.querySelector(".badge");
        if (b) b.textContent = "æœ¬æ¬¡";
      }
    }

    btnPick.disabled = spinning || candidates().length === 0;
    btnStart.disabled = (pickedIdx === null);
  }

  function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

  async function spinPick(){
    if (spinning) return;
    const pool = candidates();
    if (pool.length === 0) {
      elPickedName.textContent = "ï¼ˆå·²å…¨éƒ¨æŠ½å®Œï¼‰";
      elPickedHint.textContent = "è«‹æŒ‰ã€Œé‡ç½®ã€é‡æ–°é–‹å§‹";
      btnStart.disabled = true;
      return;
    }

    spinning = true;
    btnPick.disabled = true;
    btnStart.disabled = true;

    // æŠ½ä¹‹å‰å…ˆæ¸…æ‰ä¸Šæ¬¡ lockedï¼ˆä½†å·²ç”¨éçš„é‚„æ˜¯æš—ï¼‰
    pickedIdx = null;
    elPickedName.textContent = "æŠ½é¸ä¸­â€¦";
    elPickedHint.textContent = "è«‹ç¨ç­‰ 3.5 ç§’";
    render();

    const TOTAL_MS = 3500;
    const START_DELAY = 60;
    const END_DELAY = 320;
    const approxSteps = Math.max(10, Math.floor(TOTAL_MS / ((START_DELAY + END_DELAY) / 2)));

    const delays = [];
    for (let i=0;i<approxSteps;i++){
      const t = i / (approxSteps - 1);
      const eased = 1 - Math.pow(1 - t, 2.2);
      delays.push(Math.round(START_DELAY + (END_DELAY - START_DELAY) * eased));
    }

    for (let i=0;i<delays.length;i++){
      const idx = pool[Math.floor(Math.random() * pool.length)];
      setActive(idx);
      await sleep(delays[i]);
    }

    // æœ€çµ‚çµæœ
    const finalIdx = pool[Math.floor(Math.random() * pool.length)];
    setActive(finalIdx);
    await sleep(220);

    // ç«‹åˆ»æŠŠå®ƒè¨˜ç‚ºã€Œå·²ç”¨ã€ï¼šä¸‹æ–¹è®Šæš—
    const usedArr = loadUsed();
    usedArr.push(finalIdx);
    saveUsed(usedArr);
    saveLast(finalIdx);

    pickedIdx = finalIdx;
    const g = GROUPS[finalIdx];
    elPickedName.textContent = g.name;
    elPickedHint.textContent = "æŒ‰ Start æ‰æœƒé€²å…¥é€™çµ„é¡Œç›®";

    spinning = false;
    clearActive();
    render();
  }

  btnPick.addEventListener("click", spinPick);

  btnStart.addEventListener("click", ()=>{
    if (pickedIdx === null) return;
    window.location.href = GROUPS[pickedIdx].url;
  });

  btnReset.addEventListener("click", ()=>{
    localStorage.removeItem(KEY_USED);
    localStorage.removeItem(KEY_LAST);
    pickedIdx = null;
    clearActive();
    elPickedName.textContent = "ï¼ˆå°šæœªæŠ½ï¼‰";
    elPickedHint.textContent = "è«‹å…ˆæŒ‰ã€ŒæŠ½é¸ã€";
    render();
  });

  // è®“ä½ é‡æ–°æ•´ç†å¾Œï¼Œä¸Šæ–¹èƒ½é¡¯ç¤ºã€Œä¸Šä¸€æ¬¡æŠ½åˆ°ã€(ä¸è‡ªå‹•è·³)
  (function initLast(){
    const last = loadLast();
    if (last !== null && last >= 0 && last < GROUPS.length){
      elPickedName.textContent = `ä¸Šæ¬¡ï¼š${GROUPS[last].name}`;
      elPickedHint.textContent = "å¯æŒ‰ã€ŒæŠ½é¸ã€ç¹¼çºŒæŠ½æ–°ä¸»é¡Œ";
    }
  })();

  render();
</script>
</body>
</html>
